#!/usr/bin/env ruby

require 'rubygems' unless RUBY_VERSION =~ /1.9.*/
require 'jar_wrapper'

class SeleniumStarter
  SELENIUM_VERSION = "2.17.0"

  USAGE= <<-TEXT
    Usage:
      selenium help    - this help
      selenium install - installs selenium
      selenium         - runs the selenium server
  TEXT

  def initialize
    @wrapper = JarWrapper.new
  end

  def run
    install_dir = ENV['HOME'] + "/.selenium/assets"

    source = "http://selenium.googlecode.com/files/selenium-server-#{SELENIUM_VERSION}.zip"
    target = install_dir + "/selenium-server-#{SELENIUM_VERSION}.zip"
    jar_file = install_dir + "/selenium-#{SELENIUM_VERSION}/selenium-#{SELENIUM_VERSION}/selenium-server-standalone-#{SELENIUM_VERSION}.jar"

    param = ARGV.length == 0 ? "" : ARGV.first

    case param
      when /(-v)|(--version)/ then
        puts "Version: #{File.open(File::dirname(__FILE__) + "/../VERSION").readlines().first}"
      when 'install' then
        @wrapper.install source, target
        puts ""
      when 'help' then
        puts USAGE and return
      else
        @wrapper.jar_file = jar_file
        @wrapper.run ARGV.nil? ? [] : ARGV
    end
  end
end

SeleniumStarter.new.run
